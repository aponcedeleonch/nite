<!doctype html>
<html lang="en">
<head>
    <title>Edit Image</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <style>
        .midi {
            background-color: peachpuff;
            color: black;
            border-radius: 20px;
            padding: 10px 20px;
            text-align: center;
            margin: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .midi.selected {
            background-color: purple;
            color: white;
        }

        .hidden {
            display: none;
        }

        .midi-param {
            background-color: peachpuff;
            color: black;
            border-radius: 20px;
            padding: 10px 20px;
            text-align: center;
            margin: 5px;
        }
    
        .midi-val {
            background-color: #f8f9fa; /* Light gray */
            color: #343a40; /* Dark gray */
            border: 1px solid #ced4da; /* Gray border */
            border-radius: 0.25rem; /* Rounded corners */
            padding: 0.5rem 1rem; /* Padding */
            text-align: left; /* Left-aligned text */
            margin: 0.5rem 0; /* Margin */
            cursor: pointer; /* Hand cursor on hover */
            transition: all 0.3s ease; /* Smooth transition */
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15); /* Shadow for depth */
            font-size: 0.875rem; /* Font size */
        }

        .midi-val:hover {
            background-color: #e9ecef; /* Lighter gray on hover */
        }

        .midi-val div {
            padding: 0.25rem 0; /* Padding for options */
        }

        .midi-val div:hover {
            background-color: #dae0e5; /* Even lighter gray for option hover */
        }

        canvas {
            display: block;
            background-color: #000;
        }
    </style>
    <script>
        // Select the first MIDI by default
        window.onload = function() {
            select_midi(1);
        }

        function select_midi(midi_number) {
            // Deselect all MIDIs
            var midis = document.querySelectorAll('.midi');
            midis.forEach(function(midi) {
                midi.classList.remove('selected');
            });

            // Hide all options
            var midi_params = document.querySelectorAll('.midi-params');
            midi_params.forEach(function(midi_param) {
                midi_param.classList.add('hidden');
            });

            // Select clicked MIDI and show its options
            var selected_midi = document.getElementById('midi-' + midi_number);
            selected_midi.classList.add('selected');
            var selected_params = document.getElementById('midi-' + midi_number + '-params');
            selected_params.classList.remove('hidden');
        }
    </script>
</head>
<body>
    <div class="container">
        <h1 id="filename" class="text-center my-4">{{ nite_env.name }}</h1>
        <div class="row">
            <div class="col">
                {% for midi in nite_env.midis %}
                    <div id="midi-{{ loop.index }}" class="midi" onclick="select_midi({{ loop.index }});">MIDI {{ loop.index }}</div>
                {% endfor %}
            </div>
            <div class="col-6 text-center" id="canvasContainer" style="width: 100%; height: 500px;">
                <canvas id="particleCanvas"></canvas>
            </div>
            <div class="col">
                <form id="midi-form" method="POST" action="/save">
                    <input type="hidden" name="nite_env_name" value="{{ nite_env.name }}">
                    {% for midi in nite_env.midis %}
                        <div id="midi-{{ loop.index }}-params" class="midi-params hidden">
                            <!-- Shape -->
                            <div id="{{ shape_name }}-midi-{{ loop.index }}-param" class="midi-param">Shape</div>
                            <div id="{{ shape_name }}-midi-{{ loop.index }}-val" class="midi-val">
                                <select id="{{ shape_name }}-{{ loop.index }}" name="shape-{{ loop.index }}">
                                    <option value="">-- Please select something --</option>
                                    <option value="point">Point</option>
                                    <option value="line">Line</option>
                                    <option value="triangle">Triangle</option>
                                    <option value="plane">Plane</option>
                                    <option value="box">Box</option>
                                    <option value="sphere">Sphere</option>
                                    <option value="cylinder">Cylinder</option>
                                    <option value="cone">Cone</option>
                                    <option value="blob">Blob</option>
                                    <option value="disc">Disc</option>
                                    <option value="rectangle">Rectangle</option>
                                </select>
                            </div>

                            <!-- Color -->
                            <div id="{{ color_name }}-midi-{{ loop.index }}-param" class="midi-param">Color </div>
                            <div id="{{ color_name }}-midi-{{ loop.index }}-val" class="midi-val">
                                <input type="color" id="{{ color_name }}-{{ loop.index }}" name="{{ color_name }}-{{ loop.index }}" value="#ff0000">
                                <input type="color" id="{{ color_name }}-{{ loop.index }}" name="{{ color_name }}-{{ loop.index }}" value="#ff0000">
                                <input type="color" id="{{ color_name }}-{{ loop.index }}" name="{{ color_name }}-{{ loop.index }}" value="#ff0000">
                                <input type="color" id="{{ color_name }}-{{ loop.index }}" name="{{ color_name }}-{{ loop.index }}" value="#ff0000">
                            </div>

                            <!-- Number of particles -->
                            <div id="{{ number_of_particles_name }}-midi-{{ loop.index }}-param" class="midi-param">Number of Particles</div>
                            <div id="{{ number_of_particles_name }}-midi-{{ loop.index }}-val" class="midi-val">
                                <input type="text" id="{{ number_of_particles_name }}-{{ loop.index }}" name="{{ number_of_particles_name }}-{{ loop.index }}" placeholder="Number of particles" value="{{ midi.number_of_particles|default('', true) }}">
                            </div>

                            <!-- Velocity -->
                            <div id="{{ velocity_name }}-midi-{{ loop.index }}-param" class="midi-param">Velocity</div>
                            <div id="{{ velocity_name }}-midi-{{ loop.index }}-val" class="midi-val">
                                <input type="text" id="{{ velocity_name }}-{{ loop.index }}-x" name="{{ velocity_name }}-{{ loop.index }}-x" placeholder="X value" value="{{ midi.velocity.x|default('', true) }}">
                                <input type="text" id="{{ velocity_name }}-{{ loop.index }}-y" name="{{ velocity_name }}-{{ loop.index }}-y" placeholder="Y value" value="{{ midi.velocity.y|default('', true) }}">
                                <input type="text" id="{{ velocity_name }}-{{ loop.index }}-z" name="{{ velocity_name }}-{{ loop.index }}-z" placeholder="Z value" value="{{ midi.velocity.z|default('', true) }}">
                            </div>
                        </div>
                    {% endfor %}
                <button type="submit" class="btn btn-primary">Save</button>
                </form>
            </div>
        </div>
    </div>
    <script>
        const canvas = document.getElementById('particleCanvas');
        const ctx = canvas.getContext('2d');
        const canvasContainer = document.getElementById('canvasContainer');

        canvas.width = canvasContainer.offsetWidth;
        canvas.height = canvasContainer.offsetHeight;

        class Particle {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.velocity = { x: (Math.random() - 0.5) * 2, y: (Math.random() - 0.5) * 2 };
                this.size = Math.random() * 5 + 1;
                this.color = 'white';
            }

            update() {
                this.x += this.velocity.x;
                this.y += this.velocity.y;

                // Reinitialize particle when it moves off canvas
                if (this.x < 0 || this.x > canvas.width || this.y < 0 || this.y > canvas.height) {
                    this.x = Math.random() * canvas.width;
                    this.y = Math.random() * canvas.height;
                }
            }

            draw() {
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        let particles = [];
        for (let i = 0; i < 100; i++) {
            particles.push(new Particle());
        }

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach(particle => {
                particle.update();
                particle.draw();
            });
            requestAnimationFrame(animate);
        }

        animate();
    </script>
</body>
</html>
